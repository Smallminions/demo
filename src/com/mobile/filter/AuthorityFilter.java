package com.mobile.filter;import com.mobile.model.Employee;import com.mobile.util.DaoFactory;import javax.servlet.*;import javax.servlet.annotation.WebFilter;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;@WebFilter(filterName = "AuthorityFilter", urlPatterns = {"*.jsp"})public class AuthorityFilter implements Filter {    @Override    public void destroy() {    }    @Override    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException {        HttpServletRequest request = (HttpServletRequest) req;        HttpServletResponse response = (HttpServletResponse) resp;        // 1. 检查用户是否已登录        if (request.getSession().getAttribute("user")==null) {            request.getRequestDispatcher("/login.jsp").forward(request, response);            return;        }else {            // 2. 得到用户想访问的资源            String uri = request.getRequestURI();            String[] uris = {"/index.jsp", "/device.jsp", "/devicereturn.jsp", "/employee.jsp", "/seat.jsp","/point.jsp","/login.jsp","/devicereturn.jsp","/ResetPwd.jsp"};            // 3. 更具用户权限放行页面            Employee user = (Employee) request.getSession().getAttribute("user");            //每一次请求判断session中用户的权限与数据库中的权限是否一样,如果不一样说明修改了权限,需要重新登录            if(DaoFactory.getEmployeeDao().getEmployee(user.getEid()).getEauthority().equals(user.getEauthority())) {                if (user.getEauthority().equals("管理员")) {                    request.setAttribute("user", user);                    chain.doFilter(request, response);                } else if (user.getEauthority().equals("普通员工")) {                    for (String s : uris) {                        if (uri.equals(s)) {                            request.setAttribute("user", user);                            chain.doFilter(request, response);                            return;                        }                    }                    request.setAttribute("user", user);                    request.setAttribute("point", "对不起!您没有权限访问,请联系管理员！！！");                    request.getRequestDispatcher("/point.jsp").forward(request, response);                    chain.doFilter(request, response);                    return;                }            }else{                request.getRequestDispatcher("/login.jsp").forward(request, response);            }        }    }    @Override    public void init(FilterConfig config) throws ServletException {    }}